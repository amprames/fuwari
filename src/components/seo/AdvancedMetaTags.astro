---
interface Props {
	title?: string;
	description?: string;
	image?: string;
	url?: string;
	type?: "website" | "article" | "blog";
	publishedTime?: string;
	modifiedTime?: string;
	author?: string;
	tags?: string[];
	section?: string;
	locale?: string;
	alternateLocales?: string[];
	canonicalUrl?: string;
	noindex?: boolean;
	nofollow?: boolean;
	ogImage?: string;
	twitterCard?: "summary" | "summary_large_image";
	twitterSite?: string;
	twitterCreator?: string;
	structuredData?: Record<string, unknown>;
}

const {
	title,
	description,
	image,
	url,
	type = "website",
	publishedTime,
	modifiedTime,
	author,
	tags = [],
	section,
	locale = "es_ES",
	alternateLocales = [],
	canonicalUrl,
	noindex = false,
	nofollow = false,
	ogImage,
	twitterCard = "summary_large_image",
	twitterSite,
	twitterCreator,
	structuredData,
} = Astro.props;

const siteUrl = Astro.site?.toString() || "";
const fullUrl = canonicalUrl || (url ? `${siteUrl}${url}` : Astro.url.href);
const fullImage = image
	? image.startsWith("http")
		? image
		: `${siteUrl}${image}`
	: `${siteUrl}/og-image.jpg`;
const ogImageUrl = ogImage || fullImage;

// Generate structured data
const defaultStructuredData = {
	"@context": "https://schema.org",
	"@type": type === "article" ? "Article" : "WebSite",
	name: title,
	description: description,
	url: fullUrl,
	image: fullImage,
	...(type === "article" && {
		author: {
			"@type": "Person",
			name: author || "Autor",
		},
		datePublished: publishedTime,
		dateModified: modifiedTime || publishedTime,
		headline: title,
		keywords: tags.join(", "),
		articleSection: section,
	}),
};

const finalStructuredData = structuredData || defaultStructuredData;
---

<!-- Basic Meta Tags -->
<title>{title}</title>
<meta name="description" content={description} />
<meta name="keywords" content={tags.join(', ')} />
<meta name="author" content={author} />

<!-- Canonical URL -->
<link rel="canonical" href={fullUrl} />

<!-- Robots -->
<meta name="robots" content={`${noindex ? 'noindex' : 'index'}, ${nofollow ? 'nofollow' : 'follow'}`} />

<!-- Language and Locale -->
<meta name="language" content={locale.split('_')[0]} />
<meta property="og:locale" content={locale} />

<!-- Alternate Languages -->
{alternateLocales.map((altLocale) => (
	<link rel="alternate" hreflang={altLocale} href={`${siteUrl}${url}?lang=${altLocale}`} />
))}

<!-- Open Graph -->
<meta property="og:type" content={type} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:url" content={fullUrl} />
<meta property="og:image" content={ogImageUrl} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content={title} />
<meta property="og:site_name" content="Fuwari Blog" />

<!-- Article specific Open Graph -->
{type === 'article' && (
	<>
		<meta property="article:author" content={author} />
		<meta property="article:published_time" content={publishedTime} />
		{modifiedTime && <meta property="article:modified_time" content={modifiedTime} />}
		{section && <meta property="article:section" content={section} />}
		{tags.map((tag) => (
			<meta property="article:tag" content={tag} />
		))}
	</>
)}

<!-- Twitter Card -->
<meta name="twitter:card" content={twitterCard} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImageUrl} />
{twitterSite && <meta name="twitter:site" content={twitterSite} />}
{twitterCreator && <meta name="twitter:creator" content={twitterCreator} />}

<!-- Additional SEO Meta Tags -->
<meta name="theme-color" content="#3b82f6" />
<meta name="msapplication-TileColor" content="#3b82f6" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Preconnect to external domains -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<!-- Structured Data -->
<script type="application/ld+json" set:html={JSON.stringify(finalStructuredData)} />

<!-- Performance hints -->
<link rel="dns-prefetch" href="//fonts.googleapis.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />

<!-- Security headers -->
<meta http-equiv="X-Content-Type-Options" content="nosniff" />
<meta http-equiv="X-Frame-Options" content="DENY" />
<meta http-equiv="X-XSS-Protection" content="1; mode=block" />

<!-- Additional meta tags for better SEO -->
<meta name="format-detection" content="telephone=no" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />

<!-- Open Graph additional properties -->
<meta property="og:updated_time" content={new Date().toISOString()} />

<!-- Twitter additional properties -->
<meta name="twitter:domain" content={new URL(fullUrl).hostname} />
<meta name="twitter:url" content={fullUrl} />

<!-- Article specific Twitter -->
{type === 'article' && (
	<>
		<meta name="twitter:label1" content="Tiempo de lectura" />
		<meta name="twitter:data1" content="5 min" />
		<meta name="twitter:label2" content="Escrito por" />
		<meta name="twitter:data2" content={author || "Autor"} />
	</>
)}
